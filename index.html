<html>

<head>
    <title>INFO 3300 - Project 1</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3.layout.cloud.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Noto+Serif&display=swap" rel="stylesheet">
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            font-family: 'Noto Serif';
        }

        .gridlines line {
            stroke: #bbb;
        }

        .gridlines .domain {
            stroke: none;
        }

        .header {
            background-color: rgb(255, 0, 0, 0.8);
            /* #FF0000; */
            height: 5rem;
        }

        .title {
            font-size: 2.5rem;
            color: white;
            text-align: center;
            padding-top: 1rem;
        }

        .sub_title {
            font-size: 2rem;
            text-align: center;
            color: #282828;
        }

        .logo {
            width: 9rem;
        }

        .para {
            background-color: rgb(255, 0, 0, 0.8);
            margin-left: 9%;
            margin-right: 9%;
            margin-top: 2%;
            margin-bottom: 2%;
            padding: 1.5%;
            font-size: 1.2rem;
            color: white;
            border-radius: 20px;
        }

        /* .svg {
            margin-left: 15%;
        } */

        /* Center the SVG */
        .svg_container {
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="project1">
        <div class="header">
            <h1 class="title">Project 1</h1>
        </div>
        <div class="sub_header">
            <h2 class="sub_title">What makes a video trending on <img class="logo" src="./YouTube_Logo.svg" />?</h2>
        </div>
        <div class="para">
            Have you ever wondered what's common between the videos on the trending page? We are going to analyze
            exactly that and
            try to find some common ground between popular videos in the United States region using different
            visualizations.
        </div>
        <p id="part1">
            <div id="bar_chart" class="svg_container"></div>
            <div class="para">In publishing and graphic design, Lorem ipsum is a placeholder text commonly used to
                demonstrate the visual form of a
                document or a typeface without relying on meaningful content. Lorem ipsum may be used before final copy
                is available,
                but it may also be used to temporarily replace copy in a process called greeking, which allows designers
                to consider
                form without the meaning of the text influencing the design.</div>
        </p>
        <p id="part3">
            <div class="svg_container">
                <svg id="comparison_img" width="1000" height="400">
                    <!-- I used this link to get a Gaussian Blur https://www.w3schools.com/graphics/svg_fegaussianblur.asp -->
                    <defs>
                        <filter id="f1" x="0" y="0">
                            <feGaussianBlur in="SourceGraphic" stdDeviation="1.5" />
                        </filter>
                    </defs>
                </svg>
            </div>
            <div class="para">Standard vs High Definition. </div>
        </p>
        <p id="part4">
            <div id="word_cloud" class="svg_container"></div>
            <div class="para">The word cloud displays the 20 most frequently used tags by the trending videos on
                YouTube. The average number of tags used by each trending video is 18.81. </div>
        </p>
        <script>
            let result = [];
            d3.json("./most_popular_youtube_videos_usa_page1.json", d3.autoType)
                .then((data1) => {

                    result = result.concat(data1.items);

                    d3.json("./most_popular_youtube_videos_usa_page2.json", d3.autoType)
                        .then((data2) => {

                            result = result.concat(data2.items);

                            d3.json("./most_popular_youtube_videos_usa_page3.json", d3.autoType)
                                .then((data3) => {

                                    result = result.concat(data3.items);

                                    d3.json("./most_popular_youtube_videos_usa_page4.json", d3.autoType)
                                        .then((data4) => {

                                            const width = 800;
                                            const height = 800;
                                            const svg = d3.select("#bar_chart").append("svg")
                                                .attr("class", "svg")
                                                .attr("width", width)
                                                .attr("height", height);

                                            result = result.concat(data4.items);
                                            console.log("combined result", result);

                                            const xScale = d3.scaleBand()
                                                .domain([1, 2, 10, 17, 19, 20, 22, 23, 24, 25, 26, 27, 28, 29])
                                                .range([40, width - 20])
                                                .padding(0.1);

                                            const yScale = d3.scaleLinear()
                                                .domain([0, 50])
                                                .range([height - 20, 20]);

                                            // do stuff/explore
                                            // In final version, will concat data into a single file rather than doing it here

                                            const categories = {};
                                            result.forEach(d => {
                                                category = d.snippet.categoryId;
                                                if (categories[category]) {
                                                    categories[category] += 1;
                                                } else {
                                                    categories[category] = 1;
                                                }
                                            });
                                            console.log(categories);

                                            const categoryScale = d3.scaleOrdinal(d3.schemeCategory10);

                                            let leftAxis = d3.axisLeft(yScale);
                                            svg.append("g")
                                                .attr("class", "y axis")
                                                .attr("transform", "translate(20, 0)")
                                                .call(leftAxis);

                                            let bottomAxis = d3.axisBottom(xScale)
                                                .ticks(3)
                                                .tickSize(0);
                                            svg.append("g")
                                                .attr("class", "x axis")
                                                .attr("transform", "translate(-20, 780)")
                                                .call(bottomAxis);

                                            let leftGridlines = d3.axisLeft(yScale)
                                                .tickSize(-width + 40)
                                                .tickFormat("");
                                            svg.append("g").attr("class", "y gridlines")
                                                .attr("transform", "translate(20, 0)")
                                                .call(leftGridlines);

                                            Object.keys(categories).forEach((key, i) => {
                                                console.log(key, categories[key]);

                                                svg.append("line")
                                                    .attr("x1", xScale(key))
                                                    .attr("x2", xScale(key))
                                                    .attr("y1", height - 20)
                                                    .attr("y2", yScale(categories[key]))
                                                    .style("stroke", categoryScale(key))
                                                    .style("stroke-width", 35);
                                            });
                                            console.log(categoryScale.domain());

                                            // Add more code below


                                            // Part 3 - Standard vs High Definition
                                            let def_svg = d3.selectAll("#comparison_img");

                                            const def_svg_height = def_svg.attr("height");
                                            const def_svg_width = def_svg.attr("width");
                                            const img_width = 483;
                                            const img_height = 272.5;
                                            const translate_down = (def_svg_height - img_height) / 2;

                                            let img_area = def_svg.append("g")
                                                .attr("transform", "translate(" + def_svg_width / 2 + ", 0)")
                                                .attr("width", img_width)
                                                .attr("height", img_height);

                                            /** Used this link https://fabiofranchino.com/blog/how-to-load-image-in-svg-with-d3js/ 
                                             *  to learn how to append images using d3 **/
                                            img_area.append("image")
                                                .attr("xlink:href", "vid_img_left.jpg")
                                                .attr("transform", "translate(0, " + translate_down + ")")
                                                .attr('width', img_width / 2)
                                                .attr('height', img_height);
                                            img_area.append("image")
                                                .attr("xlink:href", "vid_img_right.jpg")
                                                .attr("transform", "translate(" + img_width / 2 + "," + translate_down + ")")
                                                .attr('width', img_width / 2)
                                                .attr('height', img_height)
                                                .style("filter", "url(#f1)");

                                            img_area.append("rect")
                                                .attr("x", img_width / 2)
                                                .attr("y", img_height);

                                            // img_area.append("text")
                                            //     .attr("transform", "translate(" + img_width / 4 + ", " + (translate_down + img_height / 2) + ")")
                                            //     .style("text-anchor", "middle")
                                            //     .style("fill", "#ffee8f")
                                            //     .style("font-size", 50)
                                            //     .style("font-family", "Impact")
                                            //     .style("stroke-width", 1)
                                            //     .style("stroke", "black")
                                            //     .text("HD: 193")

                                            // img_area.append("text")
                                            //     .attr("transform", "translate(" + 3 * img_width / 4 + ", " + (translate_down + img_height / 2) + ")")
                                            //     .style("text-anchor", "middle")
                                            //     .style("fill", "#ffee8f")
                                            //     .style("font-size", 50)
                                            //     .style("font-family", "Impact")
                                            //     .style("stroke-width", 1)
                                            //     .style("stroke", "black")
                                            //     .text("SD: 7")

                                            // img_area.append("rect")
                                            //     .attr("transform", "translate(0," + translate_down + ")")
                                            //     .attr("x", 0)
                                            //     .attr("y", 0)
                                            //     .attr("width", 8.5)
                                            //     .attr("height", 273)
                                            //     .style("fill", "white");

                                            // img_area.append("rect")
                                            //     .attr("transform", "translate(0, " + translate_down + ")")
                                            //     .attr("x", 250)
                                            //     .attr("y", 0)
                                            //     .attr("width", 235)
                                            //     .attr("height", 275)
                                            //     .style("fill", "white");

                                            let num_hd = 0;
                                            let num_sd = 0;
                                            result.forEach(d => {
                                                let vid_def = d.contentDetails.definition;
                                                console.log(vid_def);
                                                if (vid_def == "hd") {
                                                    num_hd += 1;
                                                }
                                                else {
                                                    num_sd += 1;
                                                }
                                            })
                                            console.log(num_hd);
                                            console.log(num_sd);

                                            // Part 4 - Top Tags 
                                            // Getting top 20 tags 
                                            let tagCount = 0;
                                            let tags = {};
                                            result.forEach(d => {
                                                let tagList = d.snippet.tags;
                                                if (tagList) {
                                                    tagCount += tagList.length;
                                                    tagList.forEach(item => {
                                                        if (tags[item]) {
                                                            tags[item] += 1;
                                                        }
                                                        else {
                                                            tags[item] = 1;
                                                        }
                                                    })
                                                }
                                            })
                                            console.log(tagCount / 200);

                                            /** Code for retrieving the top 20 tags was written with the guidance of this website
                                            https://stackoverflow.com/questions/32302234/object-filter-by-n-highest-numeric-values-of-keys **/
                                            var props = Object.keys(tags).map(function (key) {
                                                return { key: key, value: this[key] };
                                            }, tags);
                                            props.sort(function (p1, p2) { return p2.value - p1.value; });
                                            var topTags = props.slice(0, 20);
                                            // console.log(topTags);

                                            // Word Cloud code 
                                            // const tagScale = d3.scaleOrdinal(d3.schemePaired);
                                            // const tagScale = d3.scaleOrdinal(["#f53325", "#666262", "#ffffff", "#000000"]);
                                            const tagScale = d3.scaleOrdinal(["#e60702", "#ff8b17", "#00b51b", "#ffe500", "#00adb3", "#1e33ba", "#8c2fd4", "#ff6eb6", "#ff6b6b", "#92eb6a"])
                                            /** https://bl.ocks.org/TaraZhu/120d48c43be68e92da304cb08235d052 **/
                                            // const tagScale2 = d3.scaleSequential()
                                            //     .domain([-20, 150])
                                            //     .interpolator(d3.interpolateGreens);
                                            const wordCloud_width = 700;
                                            const wordCloud_height = 400;

                                            let wordCloud_svg = d3.select("#word_cloud").append("svg")
                                                .attr("width", wordCloud_width)
                                                .attr("height", wordCloud_height);

                                            /** Construct a cloud layout instance **/
                                            var layout = d3.layout.cloud()
                                                .size([wordCloud_width, wordCloud_height])
                                                .words(topTags.map(function (d) { return { text: d.key, size: 6 * d.value }; }))
                                                .padding(5)                                     //space between words
                                                .rotate(0)
                                                .fontSize(function (d) { return d.size; })      // font size of words
                                                .random(function (d) { return 0.45; })           // taken from https://stackoverflow.com/questions/42941368/keep-d3-cloud-consistent-between-refreshes-with-a-seed-value to prevent it from changing when refreshed
                                                .on("end", draw);
                                            layout.start();

                                            /** Take the output of layout and draw the words (fill depends on the word, font-size 
                                             *  depends on the frequency **/
                                            function draw(words) {
                                                wordCloud_svg.append("g")
                                                    .attr("transform", "translate(" + layout.size()[0] / 2 + "," + layout.size()[1] / 2 + ")")
                                                    .selectAll("text")
                                                    .data(words)
                                                    .enter().append("text")
                                                    .style("font-size", function (d) { return d.size; })
                                                    .style("fill", function (d) { return tagScale(d.text) })
                                                    // .style("stroke", "lightgrey")
                                                    // .style("stroke-width", 1)
                                                    .attr("text-anchor", "middle")
                                                    .style("font-family", "Impact")
                                                    .attr("transform", function (d) {
                                                        return "translate(" + [d.x, d.y] + ")";
                                                    })
                                                    .text(function (d) { return d.text; });
                                            }

                                        }, (error) => {
                                            console.log(error);
                                            return;
                                        });

                                }, (error) => {
                                    console.log(error);
                                    return;
                                });

                        }, (error) => {
                            console.log(error);
                            return;
                        });

                }, (error) => {
                    console.log(error);
                });

        </script>
</body>

</html>